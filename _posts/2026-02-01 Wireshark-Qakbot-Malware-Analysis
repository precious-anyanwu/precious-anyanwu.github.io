---
title: "Malware Traffic Investigation Using Wireshark (PCAP Analysis)"
date: 2026-01-29
categories: [Network Analysis, Malware Investigation, SOC]
tags: [Wireshark, PCAP Analysis, Qakbot, Traffic Analysis, Cybersecurity]
---

## Case Overview

This investigation analyzes a packet capture file **(2023-02-03.pcap)** to identify suspicious activity, Indicators of Compromise (IOCs), and evidence of malware infection within a local network.

The objective was to examine network traffic, trace malicious downloads, observe post-infection behavior, and determine the overall security impact.

üìÑ **Download Full Investigation Report (PDF):**  
[Wireshark Qakbot Malware Analysis Report](/assets/reports/Wireshark-Qakbot-Malware-Analysis.pdf)

---

## Lab Environment & Tools Used

| Category | Tools |
|---------|------|
| Traffic Analysis | Wireshark |
| Threat Intelligence | VirusTotal, OSINT |
| Packet Filtering | Wireshark Display Filters |
| File Analysis | Hash extraction, file signature inspection |
| Decoding Tool | CyberChef (Base64 decoding) |
| Protocols Investigated | HTTP, ARP, ICMP, SMTP, SMB |

---

## Initial Traffic Review

After loading the PCAP into Wireshark:

- Total packets captured: **~55,000**
- Capture duration: **2 hours 50 minutes**

Using **Statistics ‚Üí Conversations**, one internal host stood out:

> **Suspicious Host:** `10.0.0.149`

This system had an unusually high number of conversations with both internal and external IP addresses.

---

## Malicious File Download via HTTP

Filtering for HTTP traffic revealed **4 packets**. Following the HTTP stream showed:

- Source: `10.0.0.149`
- User-Agent: `curl`
- Request Type: HTTP GET  
- Requested File: `86607.dat`
- Host field was an IP address instead of a domain

![HTTP GET Request](/assets/images/wireshark-qakbot/http-get.png)

Inspection of the file content revealed the **‚ÄúMZ‚Äù** file signature, confirming the `.dat` file is a Windows executable.

![MZ Signature](/assets/images/wireshark-qakbot/mz-signature.png)

---

## Malware Confirmation

The file was exported and hashed. VirusTotal results:

- Flagged by **50+ vendors**
- Identified as **Qakbot malware**

![VirusTotal Result](/assets/images/wireshark-qakbot/virustotal.png)

---

## Post-Infection Behavior ‚Äî ARP Scanning

Filter used:
arp && eth.dst == ff:ff:ff:ff:ff:ff


Host **10.0.0.149** generated numerous ARP broadcast requests indicating network scanning.

![ARP Traffic](/assets/images/wireshark-qakbot/arp-scan.png)

---

## ICMP & Port Scanning

Active hosts discovered:

- `10.0.0.1`
- `10.0.0.6`

Multiple TCP SYN packets suggested port scanning activity.

![TCP SYN Packets](/assets/images/wireshark-qakbot/tcp-syn.png)

---

## SMTP Credential Exposure

SMTP AUTH LOGIN traffic revealed Base64 encoded credentials.

Decoded:

- Username: arthit@macnels.co.th  
- Password: Art123456

![SMTP Base64 Stream](/assets/images/wireshark-qakbot/smtp-base64.png)

---

## SMB Malware Propagation

SMB traffic showed suspicious DLL file transfers. Hashes matched Qakbot.

![SMB Export](/assets/images/wireshark-qakbot/smb-export.png)

---

## Indicators of Compromise (IOCs)

| Type | Value |
|------|------|
| Infected Host | 10.0.0.149 |
| Malware Family | Qakbot |
| Malicious File | 86607.dat |
| Behavior | ARP scanning, Port scanning, SMB propagation |
| Compromised Credentials | arthit@macnels.co.th / Art123456 |

---

## Recommended Mitigations

- Isolate host **10.0.0.149**
- Reset exposed credentials
- Block malicious external IP
- Scan network for Qakbot indicators
- Monitor SMB traffic
- Enforce encrypted protocols (HTTPS)

---

## Conclusion

This PCAP analysis revealed a full malware lifecycle: infection, reconnaissance, credential exposure, and lateral movement ‚Äî consistent with **Qakbot malware activity**.

This investigation demonstrates the importance of traffic analysis in detecting and responding to network threats.
